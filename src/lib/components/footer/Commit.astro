---
import { exec } from "child_process";
import { promisify } from "util";
import { REPO } from "$lib/data";

async function execAsync(command: string): Promise<string> {
  const { stdout } = await promisify(exec)(command);
  return stdout;
}

const { VERCEL_GIT_COMMIT_MESSAGE, VERCEL_GIT_COMMIT_SHA } = import.meta.env;
const message =
  VERCEL_GIT_COMMIT_MESSAGE ?? (await execAsync("git log -1 --pretty=%B"));
const sha = VERCEL_GIT_COMMIT_SHA ?? (await execAsync("git rev-parse HEAD"));
---

<a
  href={`https://github.com/${REPO}/tree/${sha}`}
  class="text-muted-foreground hover:text-maroon flex items-center gap-1 truncate"
>
  <span class="icon-[mdi--git]"></span>
  {message}
</a>
